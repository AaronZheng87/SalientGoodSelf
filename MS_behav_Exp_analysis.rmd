---
title: "Analyizing the Behavioral Data of Moral self (exp 1-6)"
author: "Chuanpeng Hu"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: word_document
---

<style type="text/css">

body{ /* Normal  */
   font-family: Times     
   font-size: 12px;
}
td {  /* Table  */
   font-size: 8px;
}
h1 { /* Header 1 */
 font-size: 28px;
}
h2 { /* Header 2 */
 font-size: 22px;
}
h3 { /* Header 3 */
 font-size: 18px;
 color: DarkBlue;
}
code.r{ /* Code block */
  font-size: 10px;
}
pre { /* Code block */
  font-size: 10px
}
</style>


This script is aimed at making the analysis of experiments reproducible.

```{r Initializing, include=FALSE}
Sys.setlocale("LC_ALL", "English")  # set local encoding to English
Sys.setenv(LANG = "en") # set the feedback language to English
options(scipen = 999)   # force R to output in decimal instead of scientifc notion
options(digits=5)       # limit the number of reporting
rm(list = setdiff(ls(), lsf.str()))  # remove all data but keep functions

pkgTest <- function(x)
 {
   if (!require(x,character.only = TRUE))
  {
    install.packages(x,dep = TRUE)
   if(!require(x,character.only = TRUE)) stop("Package not found")
  }
}

pkgNeeded <- (c("ez","plyr","ggplot2", "reshape2", "MBESS", "bootES"))

lapply(pkgNeeded,pkgTest)

## using APA style plot ####
# Save some time and stor APA format-related code in an object so you can easily
# use it in multiple plots
windowsFonts(Times=windowsFont("TT Times New Roman")) # explicit mapping to "times"
apatheme=theme_bw()+
        theme(panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(),
              panel.background = element_blank(),
              panel.border = element_blank(),
              text=element_text(family='Times'),
              legend.title=element_blank(),
              legend.position='top',
              axis.line.x = element_line(color='black'),
              axis.line.y = element_line(color='black'))

# define the d prime function
dprime <- function(hit,fa) {
        qnorm(hit) - qnorm(fa)
}

## code for calculate the summary with sE, adopted from cook book for R
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
        library(plyr)
        
        # New version of length which can handle NA's : if na.rm == T, don't count the
        length2 <- function(x, na.rm=FALSE){
                if(na.rm) sum(!is.na(x))
                else      length(x)
        }
        
        # this does the summary. For each group's data frame, return a vector with
        # N, mean, and sd
        datac <- ddply(data,groupvars, .drop=.drop,
                       .fun = function(xx,col){
                        c(N    = length2(xx[[col]],na.rm=na.rm),
                          mean = mean(xx[[col]],na.rm=na.rm),
                          sd   = sd  (xx[[col]],na.rm=na.rm)
                           )
                       },
                       measurevar
                       )
        # Rename the "mean" column
        
        datac <- rename(datac,c("mean" = measurevar))
        
        datac$se <- datac$sd /sqrt(datac$N)   # calculate standard error of the mean
        
        # Confidence interval mltiplier for standard error
        # calculate t-statistic for confidence interval:
        # e.g., if conf.interval is .95, use .975 (above/below), and use df5 = N-1
        ciMult <- qt(conf.interval/2 + .5, datac$N-1)
        datac$ci <- datac$se * ciMult
        
        return (datac)
}

## code for calculate the summary with sE for within subject data, adopted from cook book for R
summarySEwithin <- function(data=NULL, measurevar, betweenvars=NULL, withinvars=NULL,idvar=NULL, na.rm=FALSE, conf.interval=.95, .drop=TRUE) {
        
        # Ensure that the betweenvars and withinvars are factors
        factorvars <- vapply(data[, c(betweenvars, withinvars), drop=FALSE],
                             FUN=is.factor, FUN.VALUE=logical(1))
        
        if (!all(factorvars)) {
                nonfactorvars <- names(factorvars)[!factorvars]
                message("Automatically converting the following non-factors to factors: ",
                        paste(nonfactorvars, collapse = ", "))
                data[nonfactorvars] <- lapply(data[nonfactorvars], factor)
        }
        
        # Get the means from the un-normed data
        datac <- summarySE(data, measurevar, groupvars=c(betweenvars, withinvars),
                           na.rm=na.rm, conf.interval=conf.interval, .drop=.drop)
        
        # Drop all the unused columns (these will be calculated with normed data)
        datac$sd <- NULL
        datac$se <- NULL
        datac$ci <- NULL
        
        # Norm each subject's data
        ndata <- normDataWithin(data, idvar, measurevar, betweenvars, na.rm, .drop=.drop)
        
        # This is the name of the new column
        measurevar_n <- paste(measurevar, "_norm", sep="")
        
        # Collapse the normed data - now we can treat between and within vars the same
        ndatac <- summarySE(ndata, measurevar_n, groupvars=c(betweenvars, withinvars),
                            na.rm=na.rm, conf.interval=conf.interval, .drop=.drop)
        
        # Apply correction from Morey (2008) to the standard error and confidence interval
        #  Get the product of the number of conditions of within-S variables
        nWithinGroups    <- prod(vapply(ndatac[,withinvars, drop=FALSE], FUN=nlevels,
                                        FUN.VALUE=numeric(1)))
        correctionFactor <- sqrt( nWithinGroups / (nWithinGroups-1) )
        
        # Apply the correction factor
        ndatac$sd <- ndatac$sd * correctionFactor
        ndatac$se <- ndatac$se * correctionFactor
        ndatac$ci <- ndatac$ci * correctionFactor
        
        # Combine the un-normed means with the normed results
        merge(datac, ndatac)
}

### code for normalizing the SE
normDataWithin <- function(data=NULL, idvar, measurevar, betweenvars=NULL,
                           na.rm=FALSE, .drop=TRUE) {
        library(plyr)
        
        # Measure var on left, idvar + between vars on right of formula.
        data.subjMean <- ddply(data, c(idvar, betweenvars), .drop=.drop,
                               .fun = function(xx, col, na.rm) {
                                       c(subjMean = mean(xx[,col], na.rm=na.rm))
                               },
                               measurevar,
                               na.rm
        )
        
        # Put the subject means with original data
        data <- merge(data, data.subjMean)
        
        # Get the normalized data in a new column
        measureNormedVar <- paste(measurevar, "_norm", sep="")
        data[,measureNormedVar] <- data[,measurevar] - data[,"subjMean"] +
                mean(data[,measurevar], na.rm=na.rm)
        
        # Remove this subject mean column
        data$subjMean <- NULL
        
        return(data)
}

#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
        library(grid)
        
        # Make a list from the ... arguments and plotlist
        plots <- c(list(...), plotlist)
        
        numPlots = length(plots)
        
        # If layout is NULL, then use 'cols' to determine layout
        if (is.null(layout)) {
                # Make the panel
                # ncol: Number of columns of plots
                # nrow: Number of rows needed, calculated from # of cols
                layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                                 ncol = cols, nrow = ceiling(numPlots/cols))
        }
        
        if (numPlots==1) {
                print(plots[[1]])
                
        } else {
                # Set up the page
                grid.newpage()
                pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
                
                # Make each plot, in the correct location
                for (i in 1:numPlots) {
                        # Get the i,j matrix positions of the regions that contain this subplot
                        matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
                        
                        print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                                        layout.pos.col = matchidx$col))
                }
        }
}

```


```{r loadingData_e5,echo=FALSE,results='hide'}
df5 <- read.csv("rawdata_exp_behav_moral_asso_5.csv",header = TRUE, sep = ",",stringsAsFactors=FALSE,na.strings=c("","NA"))

# rename colnames
colnames(df5)[colnames(df5)=="Target.ACC"] <- "ACC"
colnames(df5)[colnames(df5)=="Target.RT"] <- "RT"
colnames(df5)[colnames(df5)=="YesNoResp"] <- "Matchness"
#colnames(df5)[colnames(df5)=="self"] <- "Identity"
colnames(df5)[colnames(df5)=="morality"] <- "Morality"

# renames independent variables
df5$Morality[df5$Morality == "Good"] <- "moral"
df5$Morality[df5$Morality == "Ord"] <- "average"
df5$Morality[df5$Morality == "Bad"] <- "immoral"
df5$Morality <- factor(df5$Morality, levels=c("moral", "average","immoral")) # make the variables in a specified order
df5$Identity <- factor(df5$Identity, levels=c("self", "other"))
df5$Matchness[df5$Matchness == "Yes"] <- "match"
df5$Matchness[df5$Matchness == "No"] <- "nonmatch"
df5$Matchness <- factor(df5$Matchness, levels=c("match", "nonmatch"))

#df5$Morality[df5$Shape == 'Goodself'] <- "moral"
#df5$Identity[df5$Shape == 'Goodself'] <- "self"
#df5$Morality[df5$Shape == 'Badself'] <- "immoral"
#df5$Identity[df5$Shape == 'Badself'] <- "self"
#df5$Morality[df5$Shape == 'Normalself'] <- "average"
#df5$Identity[df5$Shape == 'Normalself'] <- "self"
#df5$Morality[df5$Shape == 'Goodother'] <- "moral"
#df5$Identity[df5$Shape == 'Goodother'] <- "other"
#df5$Morality[df5$Shape == 'Badother'] <- "immoral"
#df5$Identity[df5$Shape == 'Badother'] <- "other"
#df5$Morality[df5$Shape == 'Normalother'] <- "average"
#df5$Identity[df5$Shape == 'Normalother'] <- "other"
#df5 <- df5[,-which(names(df5) %in% "Shape")]
```


```{r clean the data_e5,echo=FALSE,results='hide',warning=FALSE, message=FALSE}
df5.P <- df5[is.na(df5$BlockList.Sample),]            # data from practice
df5.T <- df5[!(is.na(df5$BlockList.Sample)),]   # data from test

# number of participant who didn't finished the experiment
#nQuit <- length(unique(df5.P$Subject)) - length(unique(df5.T$Subject))

# trials that should be excluded from analysis because of less than 200 ms
# note that this should be reconsidered when doinng DDM analysis
# and also the trials without response
excld.trials <- df5.T[df5.T$RT <= 200,]
ratio.excld.trials <- nrow(excld.trials)/nrow(df5.T) # ratio of excluded trials in all triasl.
# caculate the overall accuracy for each subject
df5.acc.g <-  ddply(df5.T,.(Subject), summarise,
                      N = length(ACC),
                      countN = sum(ACC),
                      ACC = sum(ACC)/length(ACC))
excld.sub <- df5.acc.g$Subject[df5.acc.g$ACC < 0.6]
df5.valid <- df5.T[!(df5.T$Subject %in% excld.sub),] # exclude the invalid subjects
length(unique(df5.valid$Subject)) + length(excld.sub) == length(unique(df5$Subject))
# excld.trials3 <- excld.trials[!(excld.trials$Subject %in% excld.sub),]
excld.trials2 <- df5.valid[df5.valid$RT <= 200,]
df5.V <- df5.valid[!(df5.valid$RT <= 200),]  

## Basic information of the data ####
df5.T.basic <- df5[!duplicated(df5$Subject), 1:4]
num.subj <- nrow(df5.T.basic)
numT.female <- sum(df5.T.basic$Sex == 'female');
numT.male <- sum(df5.T.basic$Sex == 'male');
ageT.mean <- round(mean(df5.T.basic$Age),2);
ageT.std <- round(sd(df5.T.basic$Age),2);
num.excld.sub <- length(unique(excld.sub))
df5.V.basic <- df5.V[!duplicated(df5.V$Subject), 1:4]
numV.female <- sum(df5.V.basic$Sex == 'female');
numV.male <- sum(df5.V.basic$Sex == 'male');
ageV.mean <- round(mean(df5.V.basic$Age),2);
ageV.std <- round(sd(df5.V.basic$Age),2);
ratio.excld.trials2 <- nrow(excld.trials2)/nrow(df5.valid)
```

## Participants
`r num.subj` college students (`r numT.female` female, age: `r ageT.mean` $\pm$ `r ageT.std`) participated in experiment 5. All partcipants were right handed, and all had normal or corrected-to-normal vision. Informed consent was obtained from all partcipants prior to the experiment according to procedure approved by a local ethics committee. `r num.excld.sub` of the participants data were excluded from the analysis because of less than 60% overall accuracy, leaving `r num.subj - num.excld.sub` participants (`r numV.female` female, age: `r ageV.mean` $\pm$ `r ageV.std` years).

##Results
###Analaysis of d prime
```{r analyzing for d prime_e5, echo=FALSE, results='hide',warning=FALSE, message=FALSE}

df5.V$sdt <- NA
for (i in 1:nrow(df5.V)){
        if (df5.V$Target.RESP[i] == df5.V$Target.CRESP[i] & df5.V$Matchness[i] == "match"){
                df5.V$sdt[i] <- "hit"
        } else if (df5.V$Target.RESP[i] == df5.V$Target.CRESP[i] & df5.V$Matchness[i] == "nonmatch"){
                df5.V$sdt[i] <- "CR"
        } else if (df5.V$Target.RESP[i] != df5.V$Target.CRESP[i] & df5.V$Matchness[i] == "match"){
                df5.V$sdt[i] <- "miss"
        } else if (df5.V$Target.RESP[i] != df5.V$Target.CRESP[i] & df5.V$Matchness[i] == "nonmatch"){
                df5.V$sdt[i] <- "FA"
        }
}

# calculate the number of each for each condition
df5.V.SDT <-  ddply(df5.V,.(Subject,Morality, Identity,sdt), summarise, N = length(sdt))


# long format to wide
df5.V.SDT_w <- dcast(df5.V.SDT, Subject + Morality + Identity ~ sdt,value.var = "N")
df5.V.SDT_w$miss[is.na(df5.V.SDT_w$miss)] <- 0
df5.V.SDT_w$FA[is.na(df5.V.SDT_w$FA)] <- 0
df5.V.SDT_w$hitR <- df5.V.SDT_w$hit/(df5.V.SDT_w$hit + df5.V.SDT_w$miss)
df5.V.SDT_w$faR <- df5.V.SDT_w$FA/(df5.V.SDT_w$FA + df5.V.SDT_w$CR)

# standardized way to deal with the extreme values
for (i in 1:nrow(df5.V.SDT_w)){
        if (df5.V.SDT_w$hitR[i] == 1){
                df5.V.SDT_w$hitR[i] <- 1 - 1/(2*(df5.V.SDT_w$hit[i] + df5.V.SDT_w$miss[i]))
        }
}

for (i in 1:nrow(df5.V.SDT_w)){
        if (df5.V.SDT_w$faR[i] == 0){
                df5.V.SDT_w$faR[i] <- 1/(2*(df5.V.SDT_w$FA[i] + df5.V.SDT_w$CR[i]))
        }
}


# calculate the d prime for each condition
df5.V.SDT_w$dprime <- mapply(dprime,df5.V.SDT_w$hitR,df5.V.SDT_w$faR)
df5.V.SDT_w.self <- df5.V.SDT_w[df5.V.SDT_w$Identity == 'self',]
df5.V.SDT_w.other <- df5.V.SDT_w[df5.V.SDT_w$Identity == 'other',]

# anova for d prime with 2*2 design
e5.d_anova <- ezANOVA(df5.V.SDT_w,dv = dprime, wid = Subject, within=.(Morality,Identity), type=3)
e5.d_anova.self <- ezANOVA(df5.V.SDT_w.self, dv = dprime, wid = Subject, within=.(Morality), type=3)
e5.d_anova.other <- ezANOVA(df5.V.SDT_w.other, dv = dprime, wid = Subject, within=.(Morality), type=3)
#print(d_anova1)


df5.V.SDT_ww <- dcast(df5.V.SDT_w, Subject ~ Identity + Morality ,value.var = "dprime")

# t-test
# moral self vs immoral self
e5.d.t.mrl_imm_slf <- t.test(df5.V.SDT_ww$self_moral,df5.V.SDT_ww$self_immoral,paired = TRUE)
df5.V.SDT_ww$mrl_imm_slf <- df5.V.SDT_ww$self_moral - df5.V.SDT_ww$self_immoral
e5.d.t.mrl_imm_slf.CI <- bootES(df5.V.SDT_ww$mrl_imm_slf,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.mrl_imm_slf <- round(as.numeric(e5.d.t.mrl_imm_slf[[1]]),3)
e5.d.df5.mrl_imm_slf <- as.numeric(e5.d.t.mrl_imm_slf[[2]])
e5.d.pvalue.mrl_imm_slf.adj <- p.adjust(as.numeric(e5.d.t.mrl_imm_slf[[3]],"bonferroni",3))
e5.d.cohens.mrl_imm_slf <- round(e5.d.t.mrl_imm_slf.CI[[1]],4) 
e5.d.CI.L.mrl_imm_slf <- round(e5.d.t.mrl_imm_slf.CI[[12]][1],4)
e5.d.CI.H.mrl_imm_slf <- round(e5.d.t.mrl_imm_slf.CI[[12]][2],4)

# moral self vs Average self
e5.d.t.mrl_ave_slf <- t.test(df5.V.SDT_ww$self_moral,df5.V.SDT_ww$self_average,paired = TRUE)
df5.V.SDT_ww$mrl_ave_slf <- df5.V.SDT_ww$self_moral - df5.V.SDT_ww$self_average
e5.d.t.mrl_ave_slf.CI <- bootES(df5.V.SDT_ww$mrl_ave_slf,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.mrl_ave_slf  <- round(as.numeric(e5.d.t.mrl_ave_slf[[1]]),3)
e5.d.df5.mrl_ave_slf  <- as.numeric(e5.d.t.mrl_ave_slf[[2]])
e5.d.pvalue.mrl_ave_slf.adj <- p.adjust(as.numeric(e5.d.t.mrl_ave_slf[[3]],"bonferroni",3))
e5.d.cohens.mrl_ave_slf <- round(e5.d.t.mrl_ave_slf.CI[[1]],4) 
e5.d.CI.L.mrl_ave_slf <- round(e5.d.t.mrl_ave_slf.CI[[12]][1],4)
e5.d.CI.H.mrl_ave_slf <- round(e5.d.t.mrl_ave_slf.CI[[12]][2],4)

# immoral self vs. Average self
e5.d.t.imm_ave_slf <- t.test(df5.V.SDT_ww$self_immoral,df5.V.SDT_ww$self_average,paired = TRUE)
df5.V.SDT_ww$imm_ave_slf <- df5.V.SDT_ww$self_immoral - df5.V.SDT_ww$self_average
e5.d.t.imm_ave_slf.CI <- bootES(df5.V.SDT_ww$imm_ave_slf,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.imm_ave_slf  <- round(as.numeric(e5.d.t.imm_ave_slf[[1]]),3)
e5.d.df5.imm_ave_slf  <- as.numeric(e5.d.t.imm_ave_slf[[2]])
e5.d.pvalue.imm_ave_slf.adj <- p.adjust(as.numeric(e5.d.t.imm_ave_slf[[3]],"bonferroni",3))
e5.d.cohens.imm_ave_slf <- round(e5.d.t.imm_ave_slf.CI[[1]],4) 
e5.d.CI.L.imm_ave_slf <- round(e5.d.t.imm_ave_slf.CI[[12]][1],4)
e5.d.CI.H.imm_ave_slf <- round(e5.d.t.imm_ave_slf.CI[[12]][2],4)

# moral other vs. immoral other
e5.d.t.mrl_imm_oth <- t.test(df5.V.SDT_ww$other_moral,df5.V.SDT_ww$other_immoral,paired = TRUE)
df5.V.SDT_ww$mrl_imm_oth <- df5.V.SDT_ww$other_moral - df5.V.SDT_ww$other_immoral
e5.d.t.mrl_imm_oth.CI <- bootES(df5.V.SDT_ww$mrl_imm_oth,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.mrl_imm_oth  <- round(as.numeric(e5.d.t.mrl_imm_oth[[1]]),3)
e5.d.df5.mrl_imm_oth  <- as.numeric(e5.d.t.mrl_imm_oth[[2]])
e5.d.pvalue.mrl_imm_oth.adj <- p.adjust(as.numeric(e5.d.t.mrl_imm_oth[[3]],"bonferroni",3))
e5.d.cohens.mrl_imm_oth <- round(e5.d.t.mrl_imm_oth.CI[[1]],4) 
e5.d.CI.L.mrl_imm_oth <- round(e5.d.t.mrl_imm_oth.CI[[12]][1],4)
e5.d.CI.H.mrl_imm_oth <- round(e5.d.t.mrl_imm_oth.CI[[12]][2],4)

# moral other vs. average other
e5.d.t.mrl_ave_oth <- t.test(df5.V.SDT_ww$other_moral,df5.V.SDT_ww$other_average,paired = TRUE)
df5.V.SDT_ww$mrl_ave_oth <- df5.V.SDT_ww$other_moral - df5.V.SDT_ww$other_average
e5.d.t.mrl_ave_oth.CI <- bootES(df5.V.SDT_ww$mrl_ave_oth,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.mrl_ave_oth  <- round(as.numeric(e5.d.t.mrl_ave_oth[[1]]),3)
e5.d.df5.mrl_ave_oth  <- as.numeric(e5.d.t.mrl_ave_oth[[2]])
e5.d.pvalue.mrl_ave_oth.adj <- p.adjust(as.numeric(e5.d.t.mrl_ave_oth[[3]],"bonferroni",3))
e5.d.cohens.mrl_ave_oth <- round(e5.d.t.mrl_ave_oth.CI[[1]],4) 
e5.d.CI.L.mrl_ave_oth <- round(e5.d.t.mrl_ave_oth.CI[[12]][1],4)
e5.d.CI.H.mrl_ave_oth <- round(e5.d.t.mrl_ave_oth.CI[[12]][2],4)

# immoral other vs. Average other
e5.d.t.imm_ave_oth <- t.test(df5.V.SDT_ww$other_immoral,df5.V.SDT_ww$other_average,paired = TRUE)
df5.V.SDT_ww$imm_ave_oth <- df5.V.SDT_ww$other_immoral - df5.V.SDT_ww$other_average
e5.d.t.imm_ave_oth.CI <- bootES(df5.V.SDT_ww$imm_ave_oth,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.imm_ave_oth  <- round(as.numeric(e5.d.t.imm_ave_oth[[1]]),3)
e5.d.df5.imm_ave_oth  <- as.numeric(e5.d.t.imm_ave_oth[[2]])
e5.d.pvalue.imm_ave_oth.adj <- p.adjust(as.numeric(e5.d.t.imm_ave_oth[[3]],"bonferroni",3))
e5.d.cohens.imm_ave_oth <- round(e5.d.t.imm_ave_oth.CI[[1]],4) 
e5.d.CI.L.imm_ave_oth <- round(e5.d.t.imm_ave_oth.CI[[12]][1],4)
e5.d.CI.H.imm_ave_oth <- round(e5.d.t.imm_ave_oth.CI[[12]][2],4)

# moral self vs moral other
e5.d.t.slf_oth_mrl <- t.test(df5.V.SDT_ww$self_moral,df5.V.SDT_ww$other_moral,paired = TRUE)
df5.V.SDT_ww$slf_oth_mrl <- df5.V.SDT_ww$self_moral - df5.V.SDT_ww$other_moral
e5.d.t.slf_oth_mrl.CI <- bootES(df5.V.SDT_ww$slf_oth_mrl,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.slf_oth_mrl  <- round(as.numeric(e5.d.t.slf_oth_mrl[[1]]),3)
e5.d.df5.slf_oth_mrl  <- as.numeric(e5.d.t.slf_oth_mrl[[2]])
e5.d.pvalue.slf_oth_mrl.adj <- p.adjust(as.numeric(e5.d.t.slf_oth_mrl[[3]],"bonferroni",3))
e5.d.cohens.slf_oth_mrl <- round(e5.d.t.slf_oth_mrl.CI[[1]],4) 
e5.d.CI.L.slf_oth_mrl <- round(e5.d.t.slf_oth_mrl.CI[[12]][1],4)
e5.d.CI.H.slf_oth_mrl <- round(e5.d.t.slf_oth_mrl.CI[[12]][2],4)

# Average self vs. Average other
e5.d.t.slf_oth_ave <- t.test(df5.V.SDT_ww$self_average,df5.V.SDT_ww$other_average,paired = TRUE)
df5.V.SDT_ww$slf_oth_ave <- df5.V.SDT_ww$self_average - df5.V.SDT_ww$other_average
e5.d.t.slf_oth_ave.CI <- bootES(df5.V.SDT_ww$slf_oth_ave,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.slf_oth_ave  <- round(as.numeric(e5.d.t.slf_oth_ave[[1]]),3)
e5.d.df5.slf_oth_ave  <- as.numeric(e5.d.t.slf_oth_ave[[2]])
e5.d.pvalue.slf_oth_ave.adj <- p.adjust(as.numeric(e5.d.t.slf_oth_ave[[3]],"bonferroni",3))
e5.d.cohens.slf_oth_ave <- round(e5.d.t.slf_oth_ave.CI[[1]],4) 
e5.d.CI.L.slf_oth_ave <- round(e5.d.t.slf_oth_ave.CI[[12]][1],4)
e5.d.CI.H.slf_oth_ave <- round(e5.d.t.slf_oth_ave.CI[[12]][2],4)

# immoral self vs. immoral other
e5.d.t.slf_oth_imm <- t.test(df5.V.SDT_ww$self_immoral,df5.V.SDT_ww$other_immoral,paired = TRUE)
df5.V.SDT_ww$slf_oth_imm <- df5.V.SDT_ww$self_immoral - df5.V.SDT_ww$other_immoral
e5.d.t.slf_oth_imm.CI <- bootES(df5.V.SDT_ww$slf_oth_imm,R = 20000, effect.type = "cohens.d")

e5.d.tvalue.slf_oth_imm  <- round(as.numeric(e5.d.t.slf_oth_imm[[1]]),3)
e5.d.df5.slf_oth_imm <- as.numeric(e5.d.t.slf_oth_imm[[2]])
e5.d.pvalue.slf_oth_imm.adj <- p.adjust(as.numeric(e5.d.t.slf_oth_imm[[3]],"bonferroni",3))
e5.d.cohens.slf_oth_imm <- round(e5.d.t.slf_oth_imm.CI[[1]],4) 
e5.d.CI.L.slf_oth_imm <- round(e5.d.t.slf_oth_imm.CI[[12]][1],4)
e5.d.CI.H.slf_oth_imm <- round(e5.d.t.slf_oth_imm.CI[[12]][2],4)

## plot and save the results of d'
df5.V.SDT.sum <- summarySE(df5.V.SDT_w,measurevar = 'dprime',groupvars = c('Morality','Identity'))
e5.d.mean.moralself <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'moral' & df5.V.SDT.sum$Identity == 'self'],3)
e5.d.sd.moralself <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'moral' & df5.V.SDT.sum$Identity == 'self'],3)
e5.d.mean.immoralself <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'immoral' & df5.V.SDT.sum$Identity == 'self'],3)
e5.d.sd.immoralself <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'immoral' & df5.V.SDT.sum$Identity == 'self'],3)
e5.d.mean.aveself <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'average' & df5.V.SDT.sum$Identity == 'self'],3)
e5.d.sd.aveself <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'average' & df5.V.SDT.sum$Identity == 'self'],3)

e5.d.mean.moralother <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'moral' & df5.V.SDT.sum$Identity == 'other'],3)
e5.d.sd.moralother <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'moral' & df5.V.SDT.sum$Identity == 'other'],3)
e5.d.mean.immoralother <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'immoral' & df5.V.SDT.sum$Identity == 'other'],3)
e5.d.sd.immoralother <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'immoral' & df5.V.SDT.sum$Identity == 'other'],3)
e5.d.mean.aveother <- round(df5.V.SDT.sum$dprime[df5.V.SDT.sum$Morality == 'average' & df5.V.SDT.sum$Identity == 'other'],3)
e5.d.sd.aveother <- round(df5.V.SDT.sum$sd[df5.V.SDT.sum$Morality == 'average' & df5.V.SDT.sum$Identity == 'other'],3)

e5.p_dprime1 <- ggplot(data = df5.V.SDT.sum,aes(y = dprime, x = Identity, group = Morality,shape = Morality, fill = Morality)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = dprime - se, ymax = dprime + se),
        #geom_errorbar(aes(ymin = 1, ymax = 4),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        labs(x = 'self-referential',y = 'd prime') +
        #ylab(" Reaction times") + 
        #ylim(1, 4) +
        ggtitle("d prime for each condition") +
        coord_cartesian(ylim=c(1,3.5))+
        scale_y_continuous(breaks = seq(1,3.5,0.5),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter. 
        #theme_classic()
        apatheme

e5.p_dprime2 <- ggplot(data = df5.V.SDT.sum,aes(y = dprime, x = Morality, group = Identity,shape = Identity, fill = Identity)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = dprime - se, ymax = dprime + se),
        #geom_errorbar(aes(ymin = 1, ymax = 4),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        labs(x = 'self-referential',y = 'd prime') +
        #ylab(" Reaction times") + 
        #ylim(1, 4) +
        ggtitle("d prime for each condition") +
        coord_cartesian(ylim=c(1,3.5))+
        scale_y_continuous(breaks = seq(1,3.5,0.5),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter. 
        #theme_classic()
        apatheme

# ggsave('dprime_mean_plot.png', width=4, height=6, unit='in', dpi=300)  # save the plot
```
ANOVA for *d'* with moral character and self-relatedness as within-subjects factors.

The main effect of `r e5.d_anova[[1]][1,1]`, *F*(`r e5.d_anova[[1]][1,2]`, `r e5.d_anova[[1]][1,3]`) = `r round(e5.d_anova[[1]][1,4],3)`, *p* = `r round(e5.d_anova[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.d_anova[[1]][1,7],4)`. 

The main effect of `r e5.d_anova[[1]][2,1]`: *F*(`r e5.d_anova[[1]][2,2]`, `r e5.d_anova[[1]][2,3]`) = `r round(e5.d_anova[[1]][2,4],3)`, *p* = `r round(e5.d_anova[[1]][2,5],4)`, $\eta_g^2$ = `r round(e5.d_anova[[1]][2,7],4)`

The interaction between `r e5.d_anova[[1]][3,1]`: *F*(`r e5.d_anova[[1]][3,2]`, `r e5.d_anova[[1]][3,3]`) = `r round(e5.d_anova[[1]][3,4],3)`, *p* = `r round(e5.d_anova[[1]][3,5],4)`, $\eta_g^2$ = `r round(e5.d_anova[[1]][3,7],4)`.

Then we conducted sample effect analysis for self- and other- association separately for the matched trials (see figure 1).

A separate repeated ANOVA for self trials showed that the effect of  `r e5.d_anova.self[[1]][1,1]`, *F*(`r e5.d_anova.self[[1]][1,2]`, `r e5.d_anova.self[[1]][1,3]`) = `r round(e5.d_anova.self[[1]][1,4],3)`, *p* = `r round(e5.d_anova.self[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.d_anova.self[[1]][1,7],4)`. 

post-hoc comparision showed that moral self (`r e5.d.mean.moralself`  $\pm$ `r e5.d.sd.moralself`) vs immoral self (`r e5.d.mean.immoralself`  $\pm$ `r e5.d.sd.immoralself`): *t*(`r e5.d.df5.mrl_imm_slf`) = `r e5.d.tvalue.mrl_imm_slf`, *p* = 
`r e5.d.pvalue.mrl_imm_slf.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.mrl_imm_slf`, 95% CI [`r e5.d.CI.L.mrl_imm_slf` `r e5.d.CI.H.mrl_imm_slf`]

Moral self (`r e5.d.mean.moralself`  $\pm$ `r e5.d.sd.moralself`) vs. Average self(`r e5.d.mean.aveself`  $\pm$ `r e5.d.sd.aveself`): *t*(`r e5.d.df5.mrl_ave_slf`) = `r e5.d.tvalue.mrl_ave_slf`, *p* = 
`r e5.d.pvalue.mrl_ave_slf.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.mrl_ave_slf`, 95% CI [`r e5.d.CI.L.mrl_ave_slf` `r e5.d.CI.H.mrl_ave_slf`]

Immoral self (`r e5.d.mean.immoralself`  $\pm$ `r e5.d.sd.immoralself`) vs. Average self (`r e5.d.mean.aveself` $\pm$ `r e5.d.sd.aveself`): *t*(`r e5.d.df5.imm_ave_slf`) = `r e5.d.tvalue.imm_ave_slf`, *p* = 
`r e5.d.pvalue.imm_ave_slf.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.imm_ave_slf`, 95% CI [`r e5.d.CI.L.imm_ave_slf` `r e5.d.CI.H.imm_ave_slf`]

Moral other (`r e5.d.mean.moralother`  $\pm$ `r e5.d.sd.moralother`) vs immoral other (`r e5.d.mean.immoralother`  $\pm$ `r e5.d.sd.immoralother`): *t*(`r e5.d.df5.mrl_imm_oth`) = `r e5.d.tvalue.mrl_imm_oth`, *p* = 
`r e5.d.pvalue.mrl_imm_oth.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.mrl_imm_oth`, 95% CI [`r e5.d.CI.L.mrl_imm_oth` `r e5.d.CI.H.mrl_imm_oth`]

Moral other (`r e5.d.mean.moralother`  $\pm$ `r e5.d.sd.moralother`) vs. Average other (`r e5.d.mean.aveother` $\pm$ `r e5.d.sd.aveother`):  *t*(`r e5.d.df5.mrl_ave_oth`) = `r e5.d.tvalue.mrl_ave_oth`, *p* = 
`r e5.d.pvalue.mrl_ave_oth.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.mrl_ave_oth`, 95% CI [`r e5.d.CI.L.mrl_ave_oth` `r e5.d.CI.H.mrl_ave_oth`]

Immoral other (`r e5.d.mean.immoralother`  $\pm$ `r e5.d.sd.immoralother`) vs. Average other(`r e5.d.mean.aveother` $\pm$ `r e5.d.sd.aveother`): *t*(`r e5.d.df5.imm_ave_oth`) = `r e5.d.tvalue.imm_ave_oth`, *p* = 
`r e5.d.pvalue.imm_ave_oth.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.imm_ave_oth`, 95% CI [`r e5.d.CI.L.imm_ave_oth` `r e5.d.CI.H.imm_ave_oth`]

repeated ANOVA for other trials showed that the effect of  `r e5.d_anova.other[[1]][1,1]`, *F*(`r e5.d_anova.other[[1]][1,2]`, `r e5.d_anova.other[[1]][1,3]`) = `r round(e5.d_anova.other[[1]][1,4],3)`, *p* = `r round(e5.d_anova.other[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.d_anova.other[[1]][1,7],4)`.

To examine the effect of self-relatedness, we also conducted t-test for self-other pair for each moral condition. 
moral self (`r e5.d.mean.moralself`  $\pm$ `r e5.d.sd.moralself`) vs. moral other (`r e5.d.mean.moralother`  $\pm$ `r e5.d.sd.moralother`): *t*(`r e5.d.df5.slf_oth_mrl`) = `r e5.d.tvalue.slf_oth_mrl`, *p* = `r e5.d.pvalue.slf_oth_mrl.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.slf_oth_mrl`, 95% CI [`r e5.d.CI.L.slf_oth_mrl` `r e5.d.CI.H.slf_oth_mrl`]

Average self (`r e5.d.mean.aveself`  $\pm$ `r e5.d.sd.aveself`) vs. Average other (`r e5.d.mean.aveother` $\pm$ `r e5.d.sd.aveother`): *t*(`r e5.d.df5.slf_oth_ave`) = `r e5.d.tvalue.slf_oth_ave`, *p* = `r e5.d.pvalue.slf_oth_ave.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.slf_oth_ave`, 95% CI [`r e5.d.CI.L.slf_oth_ave` `r e5.d.CI.H.slf_oth_ave`]
immoral self (`r e5.d.mean.immoralself` $\pm$ `r e5.d.sd.immoralself`) vs. immoral other (`r e5.d.mean.immoralother`  $\pm$ `r e5.d.sd.immoralother`): *t*(`r e5.d.df5.slf_oth_imm`) = `r e5.d.tvalue.slf_oth_imm`, *p* = `r e5.d.pvalue.slf_oth_imm.adj`, *Cohen's* $d_z$ = `r e5.d.cohens.slf_oth_imm`, 95% CI [`r e5.d.CI.L.slf_oth_imm` `r e5.d.CI.H.slf_oth_imm`]


```{r plot1 the d prime_e5, fig.width=4, fig.height=6,echo=FALSE,warning=FALSE,message=FALSE }
ggplot(data = df5.V.SDT.sum,aes(y = dprime, x = Identity, group = Morality,shape = Morality, fill = Morality)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = dprime - se, ymax = dprime + se),
        #geom_errorbar(aes(ymin = 1, ymax = 4),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        labs(x = 'self-referential',y = 'd prime') +
        #ylab(" Reaction times") + 
        #ylim(1, 4) +
        ggtitle("d prime for each condition") +
        coord_cartesian(ylim=c(1,3.5))+
        scale_y_continuous(breaks = seq(1,3.5,0.5),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter. 
        #theme_classic()
        apatheme

# ggsave('dprime_mean_plot.png', width=4, height=6, unit='in', dpi=300)  # save the plot
```

The above figure shows the d prime for each condition (way 1)

```{r plot2 the d prime_e5, fig.width=4, fig.height=6,echo=FALSE,warning=FALSE,message=FALSE }
ggplot(data = df5.V.SDT.sum,aes(y = dprime, x = Morality, group = Identity,shape = Identity, fill = Identity)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = dprime - se, ymax = dprime + se),
        #geom_errorbar(aes(ymin = 1, ymax = 4),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        labs(x = 'self-referential',y = 'd prime') +
        #ylab(" Reaction times") + 
        #ylim(1, 4) +
        ggtitle("d prime for each condition") +
        coord_cartesian(ylim=c(1,3.5))+
        scale_y_continuous(breaks = seq(1,3.5,0.5),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter. 
        #theme_classic()
        apatheme

# ggsave('dprime_mean_plot.png', width=4, height=6, unit='in', dpi=300)  # save the plot
```

The above figure shows the d prime for each condition (way 2)


```{r analyzing RT_e5,echo=FALSE,results='hide',warning=FALSE, message=FALSE}
## plot density of each subject's RT and save them individually
subNo <- unique(df5.V$Subject)
## doing the analysis for RT ####
df5.V.RT <- df5.V[df5.V$ACC ==1,]  # exclued rt data less than 200 ms, and inaccurate data
df5.V.RT.subj <- summarySEwithin(df5.V.RT,measurevar = 'RT', withinvar = c('Subject','Matchness','Morality','Identity'),idvar = 'Subject', na.rm = TRUE)
df5.V.RT.grand <- summarySE(df5.V.RT.subj,measurevar = 'RT', groupvar = c('Matchness','Morality','Identity'),na.rm = TRUE)
df5.V.RT_match <- df5.V.RT[df5.V.RT$Matchness == "match",]
df5.V.RT_nonmatch <- df5.V.RT[df5.V.RT$Matchness == "nonmatch",]
df5.V.RT_match.self <- df5.V.RT_match[df5.V.RT_match$Identity == 'self',]
df5.V.RT_match.other <- df5.V.RT_match[df5.V.RT_match$Identity == 'other',]

e5.rt_anova.match <- ezANOVA(df5.V.RT_match,dv = RT, wid = Subject, within=.(Morality,Identity),within_full=.(Identity,Morality), type=3)
e5.rt_anova.nonmatch <- ezANOVA(df5.V.RT_nonmatch,dv = RT, wid = Subject, within=.(Morality,Identity),within_full=.(Identity,Morality), type=3)

e5.rt_anova.match.self <- ezANOVA(df5.V.RT_match.self,dv = RT, wid = Subject, within=.(Morality),within_full=.(Morality), type=3)
e5.rt_anova.match.other <- ezANOVA(df5.V.RT_match.other,dv = RT, wid = Subject, within=.(Morality),within_full=.(Morality), type=3)
## t-test 
df5.V.RT.subj_w <- dcast(df5.V.RT.subj, Subject ~ Matchness + Identity + Morality ,value.var = "RT") 

e5.rt.t.m.mrl_imm_slf <- t.test(df5.V.RT.subj_w$match_self_moral,df5.V.RT.subj_w$match_self_immoral,paired = TRUE)
df5.V.RT.subj_w$m.mrl_imm_slf <- df5.V.RT.subj_w$match_self_moral - df5.V.RT.subj_w$match_self_immoral
e5.rt.t.m.mrl_imm_slf.CI <- bootES(df5.V.RT.subj_w$m.mrl_imm_slf, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.mrl_imm_slf  <- round(as.numeric(e5.rt.t.m.mrl_imm_slf [[1]]),3)
e5.rt.df5.mrl_imm_slf  <- as.numeric(e5.rt.t.m.mrl_imm_slf [[2]])
e5.rt.pvalue.mrl_imm_slf.adj <- p.adjust(as.numeric(e5.rt.t.m.mrl_imm_slf [[3]],"bonferroni",3))
e5.rt.cohens.mrl_imm_slf <- round(e5.rt.t.m.mrl_imm_slf.CI[[1]],4) 
e5.rt.CI.L.mrl_imm_slf <- round(e5.rt.t.m.mrl_imm_slf.CI[[12]][1],4)
e5.rt.CI.H.mrl_imm_slf <- round(e5.rt.t.m.mrl_imm_slf.CI[[12]][2],4)


e5.rt.t.m.mrl_ave_slf <- t.test(df5.V.RT.subj_w$match_self_moral,df5.V.RT.subj_w$match_self_average,paired = TRUE)
df5.V.RT.subj_w$m.mrl_ave_slf <- df5.V.RT.subj_w$match_self_moral - df5.V.RT.subj_w$match_self_average
e5.rt.t.m.mrl_ave_slf.CI <- bootES(df5.V.RT.subj_w$m.mrl_ave_slf, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.mrl_ave_slf  <- round(as.numeric(e5.rt.t.m.mrl_ave_slf [[1]]),3)
e5.rt.df5.mrl_ave_slf  <- as.numeric(e5.rt.t.m.mrl_ave_slf[[2]])
e5.rt.pvalue.mrl_ave_slf.adj <- p.adjust(as.numeric(e5.rt.t.m.mrl_ave_slf[[3]],"bonferroni",3))
e5.rt.cohens.mrl_ave_slf <- round(e5.rt.t.m.mrl_ave_slf.CI[[1]],4) 
e5.rt.CI.L.mrl_ave_slf <- round(e5.rt.t.m.mrl_ave_slf.CI[[12]][1],4)
e5.rt.CI.H.mrl_ave_slf <- round(e5.rt.t.m.mrl_ave_slf.CI[[12]][2],4)


e5.rt.t.m.imm_ave_slf <- t.test(df5.V.RT.subj_w$match_self_immoral,df5.V.RT.subj_w$match_self_average,paired = TRUE)
df5.V.RT.subj_w$m.imm_ave_slf <- df5.V.RT.subj_w$match_self_immoral - df5.V.RT.subj_w$match_self_average
e5.rt.t.m.imm_ave_slf.CI <- bootES(df5.V.RT.subj_w$m.imm_ave_slf, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.imm_ave_slf  <- round(as.numeric(e5.rt.t.m.imm_ave_slf[[1]]),3)
e5.rt.df5.imm_ave_slf  <- as.numeric(e5.rt.t.m.imm_ave_slf[[2]])
e5.rt.pvalue.imm_ave_slf.adj <- p.adjust(as.numeric(e5.rt.t.m.imm_ave_slf[[3]],"bonferroni",3))
e5.rt.cohens.imm_ave_slf <- round(e5.rt.t.m.imm_ave_slf.CI [[1]],4) 
e5.rt.CI.L.imm_ave_slf <- round(e5.rt.t.m.imm_ave_slf.CI[[12]][1],4)
e5.rt.CI.H.imm_ave_slf <- round(e5.rt.t.m.imm_ave_slf.CI[[12]][2],4)

e5.rt.t.m.mrl_imm_oth <- t.test(df5.V.RT.subj_w$match_self_moral,df5.V.RT.subj_w$match_self_immoral,paired = TRUE)
df5.V.RT.subj_w$m.mrl_imm_oth <- df5.V.RT.subj_w$match_self_moral - df5.V.RT.subj_w$match_self_immoral
e5.rt.t.m.mrl_imm_oth.CI <- bootES(df5.V.RT.subj_w$m.mrl_imm_oth, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.mrl_imm_oth  <- round(as.numeric(e5.rt.t.m.mrl_imm_oth [[1]]),3)
e5.rt.df5.mrl_imm_oth  <- as.numeric(e5.rt.t.m.mrl_imm_oth [[2]])
e5.rt.pvalue.mrl_imm_oth.adj <- p.adjust(as.numeric(e5.rt.t.m.mrl_imm_oth [[3]],"bonferroni",3))
e5.rt.cohens.mrl_imm_oth <- round(e5.rt.t.m.mrl_imm_oth.CI [[1]],4) 
e5.rt.CI.L.mrl_imm_oth <- round(e5.rt.t.m.mrl_imm_oth.CI [[12]][1],4)
e5.rt.CI.H.mrl_imm_oth <- round(e5.rt.t.m.mrl_imm_oth.CI [[12]][2],4)


e5.rt.t.m.mrl_ave_oth <- t.test(df5.V.RT.subj_w$match_self_moral,df5.V.RT.subj_w$match_self_average,paired = TRUE)
df5.V.RT.subj_w$m.mrl_ave_oth <- df5.V.RT.subj_w$match_self_moral - df5.V.RT.subj_w$match_self_average
e5.rt.t.m.mrl_ave_oth.CI <- bootES(df5.V.RT.subj_w$m.mrl_ave_oth, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.mrl_ave_oth  <- round(as.numeric(e5.rt.t.m.mrl_ave_oth [[1]]),3)
e5.rt.df5.mrl_ave_oth  <- as.numeric(e5.rt.t.m.mrl_ave_oth[[2]])
e5.rt.pvalue.mrl_ave_oth.adj <- p.adjust(as.numeric(e5.rt.t.m.mrl_ave_oth[[3]],"bonferroni",3))
e5.rt.cohens.mrl_ave_oth <- round(e5.rt.t.m.mrl_ave_oth.CI [[1]],4) 
e5.rt.CI.L.mrl_ave_oth <- round(e5.rt.t.m.mrl_ave_oth.CI [[12]][1],4)
e5.rt.CI.H.mrl_ave_oth <- round(e5.rt.t.m.mrl_ave_oth.CI [[12]][2],4)


e5.rt.t.m.imm_ave_oth <- t.test(df5.V.RT.subj_w$match_self_immoral,df5.V.RT.subj_w$match_self_average,paired = TRUE)
df5.V.RT.subj_w$m.imm_ave_oth <- df5.V.RT.subj_w$match_self_immoral - df5.V.RT.subj_w$match_self_average
e5.rt.t.m.imm_ave_oth.CI <- bootES(df5.V.RT.subj_w$m.imm_ave_oth, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.imm_ave_oth  <- round(as.numeric(e5.rt.t.m.imm_ave_oth[[1]]),3)
e5.rt.df5.imm_ave_oth  <- as.numeric(e5.rt.t.m.imm_ave_oth[[2]])
e5.rt.pvalue.imm_ave_oth.adj <- p.adjust(as.numeric(e5.rt.t.m.imm_ave_oth[[3]],"bonferroni",3))
e5.rt.cohens.imm_ave_oth <- round(e5.rt.t.m.imm_ave_oth.CI[[1]],4) 
e5.rt.CI.L.imm_ave_oth <- round(e5.rt.t.m.imm_ave_oth.CI[[12]][1],4)
e5.rt.CI.H.imm_ave_oth <- round(e5.rt.t.m.imm_ave_oth.CI[[12]][2],4)


e5.rt.t.m.slf_oth_mrl <- t.test(df5.V.RT.subj_w$match_self_moral,df5.V.RT.subj_w$match_other_moral,paired = TRUE)
df5.V.RT.subj_w$m.slf_oth_mrl <- df5.V.RT.subj_w$match_self_moral - df5.V.RT.subj_w$match_other_moral
e5.rt.t.m.slf_oth_mrl.CI <- bootES(df5.V.RT.subj_w$m.slf_oth_mrl, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.slf_oth_mrl  <- round(as.numeric(e5.rt.t.m.slf_oth_mrl[[1]]),3)
e5.rt.df5.slf_oth_mrl  <- as.numeric(e5.rt.t.m.slf_oth_mrl[[2]])
e5.rt.pvalue.slf_oth_mrl.adj <- p.adjust(as.numeric(e5.rt.t.m.slf_oth_mrl[[3]],"bonferroni",3))
e5.rt.cohens.slf_oth_mrl <- round(e5.rt.t.m.slf_oth_mrl.CI[[1]],4) 
e5.rt.CI.L.slf_oth_mrl <- round(e5.rt.t.m.slf_oth_mrl.CI[[12]][1],4)
e5.rt.CI.H.slf_oth_mrl <- round(e5.rt.t.m.slf_oth_mrl.CI[[12]][2],4)

e5.rt.t.m.slf_oth_imm <- t.test(df5.V.RT.subj_w$match_self_immoral,df5.V.RT.subj_w$match_other_immoral,paired = TRUE)
df5.V.RT.subj_w$m.slf_oth_imm <- df5.V.RT.subj_w$match_self_immoral - df5.V.RT.subj_w$match_other_immoral
e5.rt.t.m.slf_oth_imm.CI <- bootES(df5.V.RT.subj_w$m.slf_oth_imm, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.slf_oth_imm  <- round(as.numeric(e5.rt.t.m.slf_oth_imm[[1]]),3)
e5.rt.df5.slf_oth_imm  <- as.numeric(e5.rt.t.m.slf_oth_imm[[2]])
e5.rt.pvalue.slf_oth_imm.adj <- p.adjust(as.numeric(e5.rt.t.m.slf_oth_imm[[3]],"bonferroni",3))
e5.rt.cohens.slf_oth_imm <- round(e5.rt.t.m.slf_oth_imm.CI[[1]],4) 
e5.rt.CI.L.slf_oth_imm <- round(e5.rt.t.m.slf_oth_imm.CI[[12]][1],4)
e5.rt.CI.H.slf_oth_imm <- round(e5.rt.t.m.slf_oth_imm.CI[[12]][2],4)


e5.rt.t.m.slf_oth_ave <- t.test(df5.V.RT.subj_w$match_self_average,df5.V.RT.subj_w$match_other_average,paired = TRUE)
df5.V.RT.subj_w$m.slf_oth_ave <- df5.V.RT.subj_w$match_self_average - df5.V.RT.subj_w$match_other_average
e5.rt.t.m.slf_oth_ave.CI <- bootES(df5.V.RT.subj_w$m.slf_oth_ave, R = 5000,effect.type = "cohens.d")

e5.rt.tvalue.slf_oth_ave  <- round(as.numeric(e5.rt.t.m.slf_oth_ave[[1]]),3)
e5.rt.df5.slf_oth_ave  <- as.numeric(e5.rt.t.m.slf_oth_ave[[2]])
e5.rt.pvalue.slf_oth_ave.adj <- p.adjust(as.numeric(e5.rt.t.m.slf_oth_ave[[3]],"bonferroni",3))
e5.rt.cohens.slf_oth_ave <- round(e5.rt.t.m.slf_oth_ave.CI[[1]],4) 
e5.rt.CI.L.slf_oth_ave <- round(e5.rt.t.m.slf_oth_ave.CI[[12]][1],4)
e5.rt.CI.H.slf_oth_ave <- round(e5.rt.t.m.slf_oth_ave.CI[[12]][2],4)

df5.V.RT.grand.match <- df5.V.RT.grand[df5.V.RT.grand$Matchness == "match",]

e5.rt.mean.moralself <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'moral' & df5.V.RT.grand.match$Identity == 'self'],0)
e5.rt.sd.moralself <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'moral' & df5.V.RT.grand.match$Identity == 'self'],0)
e5.rt.mean.immoralself <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'immoral' & df5.V.RT.grand.match$Identity == 'self'],0)
e5.rt.sd.immoralself <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'immoral' & df5.V.RT.grand.match$Identity == 'self'],0)
e5.rt.mean.aveself <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'average' & df5.V.RT.grand.match$Identity == 'self'],0)
e5.rt.sd.aveself <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'average' & df5.V.RT.grand.match$Identity == 'self'],0)

e5.rt.mean.moralother <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'moral' & df5.V.RT.grand.match$Identity == 'other'],0)
e5.rt.sd.moralother <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'moral' & df5.V.RT.grand.match$Identity == 'other'],0)
e5.rt.mean.immoralother <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'immoral' & df5.V.RT.grand.match$Identity == 'other'],0)
e5.rt.sd.immoralother <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'immoral' & df5.V.RT.grand.match$Identity == 'other'],0)
e5.rt.mean.aveother <- round(df5.V.RT.grand.match$RT[df5.V.RT.grand.match$Morality == 'average' & df5.V.RT.grand.match$Identity == 'other'],0)
e5.rt.sd.aveother <- round(df5.V.RT.grand.match$sd[df5.V.RT.grand.match$Morality == 'average' & df5.V.RT.grand.match$Identity == 'other'],0)

e5.p_rt1 <- ggplot(data = df5.V.RT.grand.match, aes(x=Identity,y=RT,group=Morality,shape = Morality,fill = Morality)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = RT-se, ymax = RT + se),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        xlab("Moral valence") +
        ylab(" Reaction times (ms)") + 
        coord_cartesian(ylim=c(500,800)) +
        scale_y_continuous(breaks=seq(500,800,50),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter.
        #ylim(0.3, 0.8) +
        ggtitle("RT for each condition") +
        #scale_y_continuous("Reation Times (ms)") + 
        apatheme

e5.p_rt2 <- ggplot(data = df5.V.RT.grand.match, aes(x=Morality,y=RT,group=Identity,shape = Identity,fill = Identity)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = RT-se, ymax = RT + se),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        xlab("Moral valence") +
        ylab(" Reaction times (ms)") + 
        coord_cartesian(ylim=c(500,800))+
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter.
        #ylim(0.3, 0.8) +
        ggtitle("RT for each condition") +
        scale_y_continuous("Reation Times  (ms)",expand = c(0, 0)) + 
        apatheme
# ggsave('RT_mean_plot.png', width=4, height=6, unit='in', dpi=300)  # save the plot


tiff(filename = "Figure 3. d prime and RTs of Experiment 3.tiff", width = 8, height = 6, units = 'in', res = 300)
multiplot(e5.p_dprime1,e5.p_rt1,cols = 2)
dev.off()

tiff(filename = "Figure 3.1. d prime and RTs of Experiment 3 (way 2).tiff", width = 8, height = 6, units = 'in', res = 300)
multiplot(e5.p_dprime2,e5.p_rt2,cols = 2)
dev.off()

```

We conducted a 3 * 2 rmANOVA for RT
For the matched trials, 
The effect of `r e5.rt_anova.match[[1]][1,1]`: *F*(`r e5.rt_anova.match[[1]][1,2]`, `r e5.rt_anova.match[[1]][1,3]`) = `r round(e5.rt_anova.match[[1]][1,4],3)`, *p* = `r round(e5.rt_anova.match[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.match[[1]][1,7],4)`

The effect of `r e5.rt_anova.match[[1]][2,1]`: *F*(`r e5.rt_anova.match[[1]][2,2]`, `r e5.rt_anova.match[[1]][2,3]`) = `r round(e5.rt_anova.match[[1]][2,4],3)`, *p* = `r round(e5.rt_anova.match[[1]][2,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.match[[1]][2,7],4)`

The effect of `r e5.rt_anova.match[[1]][3,1]`: *F*(`r e5.rt_anova.match[[1]][3,2]`, `r e5.rt_anova.match[[1]][3,3]`) = `r round(e5.rt_anova.match[[1]][3,4],3)`, *p* = `r round(e5.rt_anova.match[[1]][3,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.match[[1]][3,7],4)`.

For the nonmatched trials, 
The effect of `r e5.rt_anova.nonmatch[[1]][1,1]`: *F*(`r e5.rt_anova.nonmatch[[1]][1,2]`, `r e5.rt_anova.nonmatch[[1]][1,3]`) = `r round(e5.rt_anova.nonmatch[[1]][1,4],3)`, *p* = `r round(e5.rt_anova.nonmatch[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.nonmatch[[1]][1,7],4)`

The effect of `r e5.rt_anova.nonmatch[[1]][2,1]`: *F*(`r e5.rt_anova.nonmatch[[1]][2,2]`, `r e5.rt_anova.nonmatch[[1]][2,3]`) = `r round(e5.rt_anova.nonmatch[[1]][2,4],3)`, *p* = `r round(e5.rt_anova.nonmatch[[1]][2,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.nonmatch[[1]][2,7],4)`

The effect of `r e5.rt_anova.nonmatch[[1]][3,1]`: *F*(`r e5.rt_anova.nonmatch[[1]][3,2]`, `r e5.rt_anova.nonmatch[[1]][3,3]`) = `r round(e5.rt_anova.nonmatch[[1]][3,4],3)`, *p* = `r round(e5.rt_anova.nonmatch[[1]][3,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.nonmatch[[1]][3,7],4)`.

Then we conducted sample effect analysis for self- and other- association separately for the matched trials.
A separate ANOVA for self trials showed that the effect of `r e5.rt_anova.match.self[[1]][1,1]`: *F*(`r e5.rt_anova.match.self[[1]][1,2]`, `r e5.rt_anova.match.self[[1]][1,3]`) = `r round(e5.rt_anova.match.self[[1]][1,4],3)`, *p* = `r round(e5.rt_anova.match.self[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.match.self[[1]][1,7],4)`

A separate ANOVA for other trials showed that the effect of `r e5.rt_anova.match.other[[1]][1,1]`: *F*(`r e5.rt_anova.match.other[[1]][1,2]`, `r e5.rt_anova.match.other[[1]][1,3]`) = `r round(e5.rt_anova.match.other[[1]][1,4],3)`, *p* = `r round(e5.rt_anova.match.other[[1]][1,5],4)`, $\eta_g^2$ = `r round(e5.rt_anova.match.other[[1]][1,7],4)`

Moral self (`r e5.rt.mean.moralself` $\pm$ `r e5.rt.sd.moralself`) vs immoral self (`r e5.rt.mean.immoralself` $\pm$ `r e5.rt.sd.immoralself`): *t*(`r e5.rt.df5.mrl_imm_slf`) = `r e5.rt.tvalue.mrl_imm_slf`, *p* = 
`r e5.rt.pvalue.mrl_imm_slf.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.mrl_imm_slf`, 95% CI [`r e5.rt.CI.L.mrl_imm_slf` `r e5.rt.CI.H.mrl_imm_slf`]

Moral self (`r e5.rt.mean.moralself` $\pm$ `r e5.rt.sd.moralself`) vs. average self (`r e5.rt.mean.aveself` $\pm$ `r e5.rt.sd.aveself`): *t*(`r e5.rt.df5.mrl_ave_slf`) = `r e5.rt.tvalue.mrl_ave_slf`, *p* = 
`r e5.rt.pvalue.mrl_ave_slf.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.mrl_ave_slf`, 95% CI [`r e5.rt.CI.L.mrl_ave_slf` `r e5.rt.CI.H.mrl_ave_slf`]

Immoral self (`r e5.rt.mean.immoralself` $\pm$ `r e5.rt.sd.immoralself`) vs. average self (`r e5.rt.mean.aveself` $\pm$ `r e5.rt.sd.aveself`): *t*(`r e5.rt.df5.imm_ave_slf`) = `r e5.rt.tvalue.imm_ave_slf`, *p* = 
`r e5.rt.pvalue.imm_ave_slf.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.imm_ave_slf`, 95% CI [`r e5.rt.CI.L.imm_ave_slf` `r e5.rt.CI.H.imm_ave_slf`]

Moral other (`r e5.rt.mean.moralother` $\pm$ `r e5.rt.sd.moralother`)  vs immoral other (`r e5.rt.mean.immoralother` $\pm$ `r e5.rt.sd.immoralother`): *t*(`r e5.rt.df5.mrl_imm_oth`) = `r e5.rt.tvalue.mrl_imm_oth`, *p* = 
`r e5.rt.pvalue.mrl_imm_oth.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.mrl_imm_oth`, 95% CI [`r e5.rt.CI.L.mrl_imm_oth` `r e5.rt.CI.H.mrl_imm_oth`]

Moral other (`r e5.rt.mean.moralother` $\pm$ `r e5.rt.sd.moralother`)  vs. average other (`r e5.rt.mean.aveother` $\pm$ `r e5.rt.sd.aveother`): *t*(`r e5.rt.df5.mrl_ave_oth`) = `r e5.rt.tvalue.mrl_ave_oth`, *p* = 
`r e5.rt.pvalue.mrl_ave_oth.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.mrl_ave_oth`, 95% CI [`r e5.rt.CI.L.mrl_ave_oth` `r e5.rt.CI.H.mrl_ave_oth`]

Immoral other (`r e5.rt.mean.immoralother` $\pm$ `r e5.rt.sd.immoralother`) vs. average other(`r e5.rt.mean.aveother` $\pm$ `r e5.rt.sd.aveother`): *t*(`r e5.rt.df5.imm_ave_oth`) = `r e5.rt.tvalue.imm_ave_oth`, *p* = 
`r e5.rt.pvalue.imm_ave_oth.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.imm_ave_oth`, 95% CI [`r e5.rt.CI.L.imm_ave_oth` `r e5.rt.CI.H.imm_ave_oth`]

To examine the effect of self-relatedness, we also conducted t-test for self-other pair for each moral condition.

moral self (`r e5.rt.mean.moralself` $\pm$ `r e5.rt.sd.moralself`) vs. moral other (`r e5.rt.mean.moralother` $\pm$ `r e5.rt.sd.moralother`) : *t*(`r e5.rt.df5.slf_oth_mrl`) = `r e5.rt.tvalue.slf_oth_mrl`, *p* = `r e5.rt.pvalue.slf_oth_mrl.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.slf_oth_mrl`, 95% CI [`r e5.rt.CI.L.slf_oth_mrl` `r e5.rt.CI.H.slf_oth_mrl`]

average self (`r e5.rt.mean.aveself` $\pm$ `r e5.rt.sd.aveself`) vs. average other (`r e5.rt.mean.aveother` $\pm$ `r e5.rt.sd.aveother`): *t*(`r e5.rt.df5.slf_oth_ave`) = `r e5.rt.tvalue.slf_oth_ave`, *p* = `r e5.rt.pvalue.slf_oth_ave.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.slf_oth_ave`, 95% CI [`r e5.rt.CI.L.slf_oth_ave` `r e5.rt.CI.H.slf_oth_ave`]

immoral self (`r e5.rt.mean.immoralself` $\pm$ `r e5.rt.sd.immoralself`) vs. immoral other (`r e5.rt.mean.immoralother` $\pm$ `r e5.rt.sd.immoralother`): *t*(`r e5.rt.df5.slf_oth_imm`) = `r e5.rt.tvalue.slf_oth_imm`, *p* = `r e5.rt.pvalue.slf_oth_imm.adj`, *Cohen's* $d_z$ = `r e5.rt.cohens.slf_oth_imm`, 95% CI [`r e5.rt.CI.L.slf_oth_imm` `r e5.rt.CI.H.slf_oth_imm`]


```{r plot2 the RT_e5, fig.width=4, fig.height=6,echo=FALSE,warning=FALSE,message=FALSE }
# change a way to plot
ggplot(data = df5.V.RT.grand.match, aes(x=Identity,y=RT,group=Morality,shape = Morality,fill = Morality)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = RT-se, ymax = RT + se),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        xlab("Moral valence") +
        ylab(" Reaction times (ms)") + 
        coord_cartesian(ylim=c(500,800)) +
        scale_y_continuous(breaks=seq(500,800,50),expand = c(0, 0)) +
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter.
        #ylim(0.3, 0.8) +
        ggtitle("RT for each condition") +
        #scale_y_continuous("Reation Times (ms)") + 
        apatheme
#ggsave('RT_mean_plot2.png', width=4, height=6, unit='in', dpi=300)  # save the plot

```

The above is the reaction time for each condition

```{r plot1 the RT_e5, fig.width=4, fig.height=6,echo=FALSE,warning=FALSE,message=FALSE }
# df5.V.RT.grand.match <- df5.V.RT.grand[df5.V.RT.grand$Matchness == "match",]
ggplot(data = df5.V.RT.grand.match, aes(x=Morality,y=RT,group=Identity,shape = Identity,fill = Identity)) +
        geom_bar(position = position_dodge(),stat = "identity",colour = "black", size=.3) +         # Thinner lines
        geom_errorbar(aes(ymin = RT-se, ymax = RT + se),
                      size = .3,
                      width = .2,
                      position=position_dodge(.9)) +
        xlab("Moral valence") +
        ylab(" Reaction times (ms)") + 
        coord_cartesian(ylim=c(500,800))+
        scale_fill_grey (start=0.2, end=0.8) +   # using grey scale, start from darker, end to lighter.
        #ylim(0.3, 0.8) +
        ggtitle("RT for each condition") +
        scale_y_continuous("Reation Times  (ms)",expand = c(0, 0)) + 
        apatheme
#ggsave('RT_mean_plot.png', width=4, height=6, unit='in', dpi=300)  # save the plot

```

The above is another way to plot.
